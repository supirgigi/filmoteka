{"mappings":"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","sources":["src/library.js","src/js/library.js","src/js/libraryModal.js"],"sourcesContent":["import './js/Api';\nimport './js/refs';\nimport './js/auth';\nimport './js/library';\nimport './js/pagination';\nimport './js/libraryModal';\nimport './js/authModal';\nimport './js/preloader';\n","import { refs } from './refs';\nimport { onSnapshot, doc } from 'firebase/firestore';\nimport { paginationSettings } from './pagination';\nimport { movieApi } from './Api';\nimport { cardLibraryTemplate } from './cardTemplate';\nimport { initializePagination } from './pagination';\nimport Notiflix from 'notiflix';\nimport { spinner } from './preloader';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { auth, db } from './auth';\n\nconst watchedBtn = document.querySelector('[data-watched]');\nconst queueBtn = document.querySelector('[data-queue]');\n\nonAuthStateChanged(auth, user => {\n  if (user) {\n    console.log('user logged in: ', user);\n    refs.authSignOut.parentElement.classList.remove('hidden');\n    refs.authOpen.parentElement.classList.add('hidden');\n    onWatched();\n  } else {\n    console.log('user logged out');\n    refs.authSignOut.parentElement.classList.add('hidden');\n    refs.authOpen.parentElement.classList.remove('hidden');\n    refs.pagination.classList.add('visually-hidden');\n  }\n});\n\nwatchedBtn.addEventListener('click', onWatched);\nqueueBtn.addEventListener('click', onQueue);\n\nasync function onWatched() {\n  if (!auth.currentUser) {\n    Notiflix.Notify.failure('Please sign in');\n    return;\n  }\n\n  movieApi.resetPage();\n\n  refs.movieList.innerHTML = '';\n  watchedBtn.classList.add('library-btns__btn_current');\n  queueBtn.classList.remove('library-btns__btn_current');\n\n  paginationSettings.paginationType = 'watched';\n  monitorWatchedChanges();\n}\n\nasync function onQueue() {\n  if (!auth.currentUser) {\n    Notiflix.Notify.failure('Please sign in');\n    return;\n  }\n\n  movieApi.resetPage();\n\n  refs.movieList.innerHTML = '';\n  watchedBtn.classList.remove('library-btns__btn_current');\n  queueBtn.classList.add('library-btns__btn_current');\n\n  paginationSettings.paginationType = 'queue';\n  monitorQueueChanges();\n}\n\nfunction monitorWatchedChanges() {\n  onSnapshot(doc(db, 'users', auth.currentUser.uid), snapshot => {\n    spinner.show();\n    const { watchedMovies } = snapshot.data();\n\n    paginationSettings.maxPages = Math.ceil(\n      watchedMovies.length / paginationSettings.perPage\n    );\n\n    let paginatedResults = watchedMovies.filter((result, index) => {\n      return (\n        index < movieApi.page * paginationSettings.perPage &&\n        index >=\n          movieApi.page * paginationSettings.perPage -\n            paginationSettings.perPage\n      );\n    });\n\n    if (paginatedResults.length === 0) {\n      console.log('empty');\n      movieApi.page -= 1;\n      paginatedResults = watchedMovies.filter((result, index) => {\n        return (\n          index < movieApi.page * paginationSettings.perPage &&\n          index >=\n            movieApi.page * paginationSettings.perPage -\n              paginationSettings.perPage\n        );\n      });\n    }\n\n    console.log(paginatedResults);\n\n    const markup = paginatedResults.map(cardLibraryTemplate).join('');\n    refs.movieList.innerHTML = markup;\n    initializePagination();\n    spinner.close();\n  });\n}\n\nfunction monitorQueueChanges() {\n  onSnapshot(doc(db, 'users', auth.currentUser.uid), snapshot => {\n    spinner.show();\n    const { queuedMovies } = snapshot.data();\n\n    paginationSettings.maxPages = Math.ceil(\n      queuedMovies.length / paginationSettings.perPage\n    );\n\n    let paginatedResults = queuedMovies.filter((result, index) => {\n      return (\n        index < movieApi.page * paginationSettings.perPage &&\n        index >=\n          movieApi.page * paginationSettings.perPage -\n            paginationSettings.perPage\n      );\n    });\n\n    if (paginatedResults.length === 0) {\n      console.log('empty');\n      movieApi.page--;\n      paginatedResults = queuedMovies.filter((result, index) => {\n        return (\n          index < movieApi.page * paginationSettings.perPage &&\n          index >=\n            movieApi.page * paginationSettings.perPage -\n              paginationSettings.perPage\n        );\n      });\n    }\n\n    console.log(paginatedResults);\n\n    const markup = paginatedResults.map(cardLibraryTemplate).join('');\n    refs.movieList.innerHTML = markup;\n    initializePagination();\n    spinner.close();\n  });\n}\n","import { refs } from './refs';\nimport { movieApi } from './Api';\nimport { dataFormat } from './dataFormat';\nimport { auth, db } from './auth';\nimport { selectedQueueTemplate, selectedWatchedTemplate } from './cardTemplate';\nimport { getDoc, doc, updateDoc } from 'firebase/firestore';\nimport { paginationSettings } from './pagination';\nimport Notiflix from 'notiflix';\n\nrefs.movieList.addEventListener('click', onLibraryClick);\n\nlet watchedRemove;\nlet queueRemove;\nlet currentMovie;\n\nfunction onLibraryClick(e) {\n  if (e.target === e.currentTarget) {\n    return;\n  }\n  const card = e.target.closest('li');\n  movieApi.id = card.dataset.id;\n  try {\n    movieApi.getMovie().then(data => {\n      const formattedData = dataFormat(data);\n      currentMovie = formattedData;\n      let modalMarkup;\n      console.log(currentMovie);\n\n      if (paginationSettings.paginationType === 'watched') {\n        modalMarkup = selectedWatchedTemplate(formattedData);\n        refs.movieModal.innerHTML = modalMarkup;\n        onWatchedCard();\n      } else {\n        modalMarkup = selectedQueueTemplate(formattedData);\n        refs.movieModal.innerHTML = modalMarkup;\n        onQueueCard();\n      }\n\n      refs.backdrop.classList.toggle('is-hidden');\n      refs.body.classList.toggle('locked');\n\n      refs.modalCloseBtn.addEventListener('click', toggleLibraryModal);\n      window.addEventListener('keydown', onEscPress);\n      refs.backdrop.addEventListener('click', onBackdropClick);\n    });\n  } catch (error) {\n    Notiflix.Notify.failure(error.message);\n  }\n}\n\nfunction onWatchedCard() {\n  watchedRemove = document.querySelector('[data-watched-remove]');\n  watchedRemove.addEventListener('click', removeFromWatchedLib);\n}\n\nfunction onQueueCard() {\n  queueRemove = document.querySelector('[data-queue-remove]');\n  queueRemove.addEventListener('click', removeFromQueueLib);\n}\n\nasync function removeFromQueueLib() {\n  let { queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n  queuedMovies = queuedMovies.filter(movie => {\n    return movie.id !== currentMovie.id;\n  });\n  await updateDoc(doc(db, 'users', auth.currentUser.uid), {\n    queuedMovies,\n  }).then(() => {\n    toggleLibraryModal();\n    Notiflix.Notify.success('Removed successfully');\n  });\n}\n\nasync function removeFromWatchedLib() {\n  let { watchedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n  watchedMovies = watchedMovies.filter(movie => {\n    return movie.id !== currentMovie.id;\n  });\n  await updateDoc(doc(db, 'users', auth.currentUser.uid), {\n    watchedMovies,\n  }).then(() => {\n    toggleLibraryModal();\n    Notiflix.Notify.success('Removed successfully');\n  });\n}\n\nfunction toggleLibraryModal() {\n  refs.backdrop.classList.toggle('is-hidden');\n  refs.body.classList.toggle('locked');\n  window.removeEventListener('keydown', onEscPress);\n  refs.modalCloseBtn.removeEventListener('click', toggleLibraryModal);\n  refs.backdrop.removeEventListener('click', onBackdropClick);\n  if (watchedRemove) {\n    watchedRemove.removeEventListener('click', removeFromWatchedLib);\n  } else {\n    queueRemove.removeEventListener('click', removeFromQueueLib);\n  }\n}\n\nfunction onEscPress(e) {\n  if ((e.code = 'ESC')) {\n    toggleLibraryModal();\n  }\n}\n\nfunction onBackdropClick(e) {\n  if (e.target === e.currentTarget) {\n    toggleLibraryModal();\n  }\n}\n"],"names":["parcelRequire","$bpxeT","$93effc6fc56091ad$var$watchedBtn","document","querySelector","$93effc6fc56091ad$var$queueBtn","$93effc6fc56091ad$var$onWatched","$93effc6fc56091ad$var$_onWatched","apply","this","arguments","$parcel$interopDefault","$2TvXO","mark","_callee","$euqRf","auth","currentUser","$iU1Pc","Notify","failure","$fkvfI","movieApi","resetPage","$4Nugj","refs","movieList","innerHTML","classList","add","remove","$jcFG7","paginationSettings","paginationType","$93effc6fc56091ad$var$monitorWatchedChanges","$93effc6fc56091ad$var$_onQueue","$93effc6fc56091ad$var$monitorQueueChanges","$6m2hf","onSnapshot","doc","db","uid","snapshot","$4smAb","spinner","show","watchedMovies","data","maxPages","Math","ceil","length","perPage","paginatedResults","filter","result","index","page","console","log","markup","map","$bXAnp","cardLibraryTemplate","join","initializePagination","close","queuedMovies","$gQOBw","onAuthStateChanged","user","authSignOut","parentElement","authOpen","pagination","addEventListener","$c0832a3ae1aa9857$var$watchedRemove","$c0832a3ae1aa9857$var$queueRemove","$c0832a3ae1aa9857$var$currentMovie","$c0832a3ae1aa9857$var$removeFromQueueLib","$c0832a3ae1aa9857$var$_removeFromQueueLib","getDoc","then","res","_ctx","sent","movie","id","updateDoc","$c0832a3ae1aa9857$var$toggleLibraryModal","success","$c0832a3ae1aa9857$var$removeFromWatchedLib","$c0832a3ae1aa9857$var$_removeFromWatchedLib","backdrop","toggle","body","window","removeEventListener","$c0832a3ae1aa9857$var$onEscPress","modalCloseBtn","$c0832a3ae1aa9857$var$onBackdropClick","e","code","target","currentTarget","card","closest","dataset","getMovie","modalMarkup","formattedData","$Db1qJ","dataFormat","selectedWatchedTemplate","movieModal","selectedQueueTemplate","error","message"],"version":3,"file":"library.ee0ff2b8.js.map"}
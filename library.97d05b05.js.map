{"mappings":"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","sources":["src/library.js","src/js/library.js","src/js/libraryModal.js"],"sourcesContent":["import './js/Api';\nimport './js/refs';\nimport './js/auth';\nimport './js/library';\nimport './js/pagination';\nimport './js/libraryModal';\nimport './js/authModal';\nimport './js/preloader';\n","import { refs } from './refs';\nimport { getDoc, doc } from 'firebase/firestore';\nimport { paginationSettings } from './pagination';\nimport { movieApi } from './Api';\nimport { cardLibraryTemplate } from './cardTemplate';\nimport { initializePagination } from './pagination';\nimport Notiflix from 'notiflix';\nimport { spinner } from './preloader';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { auth, db } from './auth';\n\nconst watchedBtn = document.querySelector('[data-watched]');\nconst queueBtn = document.querySelector('[data-queue]');\n\nonAuthStateChanged(auth, user => {\n  if (user) {\n    // docRef = doc(db, 'users', `${user.uid}`);\n    console.log('user logged in: ', user);\n    refs.authSignOut.parentElement.classList.remove('hidden');\n    refs.authOpen.parentElement.classList.add('hidden');\n    onWatchedClick();\n  } else {\n    console.log('user logged out');\n    refs.authSignOut.parentElement.classList.add('hidden');\n    refs.authOpen.parentElement.classList.remove('hidden');\n    refs.pagination.classList.add('visually-hidden');\n  }\n});\n\nwatchedBtn.addEventListener('click', onWatchedClick);\nqueueBtn.addEventListener('click', onQueueClick);\n\nasync function onWatchedClick() {\n  if (!auth.currentUser) {\n    Notiflix.Notify.failure('Please sign in');\n    return;\n  }\n\n  spinner.show();\n\n  movieApi.resetPage();\n\n  refs.movieList.innerHTML = '';\n  watchedBtn.classList.add('library-btns__btn_current');\n  queueBtn.classList.remove('library-btns__btn_current');\n\n  const { watchedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n\n  paginationSettings.paginationType = 'watched';\n  paginationSettings.maxPages = Math.ceil(\n    watchedMovies.length / paginationSettings.perPage\n  );\n\n  console.log('watched movies: ', watchedMovies);\n  console.log(paginationSettings.maxPages);\n  initializePagination();\n\n  const paginatedResults = watchedMovies.filter((result, index) => {\n    return index < movieApi.page * paginationSettings.perPage;\n  });\n  // console.log('paginated results: ', paginatedResults);\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  spinner.close();\n}\n\nasync function onQueueClick() {\n  if (!auth.currentUser) {\n    Notiflix.Notify.failure('Please sign in');\n    return;\n  }\n\n  spinner.show();\n\n  movieApi.resetPage();\n\n  refs.movieList.innerHTML = '';\n  watchedBtn.classList.remove('library-btns__btn_current');\n  queueBtn.classList.add('library-btns__btn_current');\n\n  const { queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n\n  paginationSettings.paginationType = 'queue';\n  paginationSettings.maxPages = Math.ceil(\n    queuedMovies.length / paginationSettings.perPage\n  );\n\n  console.log('queue movies: ', queuedMovies);\n  console.log(paginationSettings.maxPages);\n  initializePagination();\n  const paginatedResults = queuedMovies.filter((result, index) => {\n    return index < movieApi.page * paginationSettings.perPage;\n  });\n  // console.log('paginated results: ', paginatedResults);\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n\n  spinner.close();\n}\n","import { refs } from './refs';\nimport { movieApi } from './Api';\nimport { dataFormat } from './dataFormat';\nimport { auth, db } from './auth';\nimport {\n  cardLibraryTemplate,\n  selectedQueueTemplate,\n  selectedWatchedTemplate,\n} from './cardTemplate';\nimport { getDoc, doc, setDoc } from 'firebase/firestore';\nimport { initializePagination, paginationSettings } from './pagination';\nimport Notiflix from 'notiflix';\n\nrefs.movieList.addEventListener('click', onLibraryClick);\n\nlet watchedRemove;\nlet queueRemove;\nlet currentMovie;\n\nfunction onLibraryClick(e) {\n  if (e.target === e.currentTarget) {\n    return;\n  }\n  const card = e.target.closest('li');\n  movieApi.id = card.dataset.id;\n  try {\n    movieApi.getMovie().then(data => {\n      const formattedData = dataFormat(data);\n      currentMovie = formattedData;\n      let modalMarkup;\n      console.log(currentMovie);\n\n      if (paginationSettings.paginationType === 'watched') {\n        modalMarkup = selectedWatchedTemplate(formattedData);\n        refs.movieModal.innerHTML = modalMarkup;\n        onWatchedCard();\n      } else {\n        modalMarkup = selectedQueueTemplate(formattedData);\n        refs.movieModal.innerHTML = modalMarkup;\n        onQueueCard();\n      }\n\n      refs.backdrop.classList.toggle('is-hidden');\n      refs.body.classList.toggle('locked');\n\n      refs.modalCloseBtn.addEventListener('click', toggleLibraryModal);\n      window.addEventListener('keydown', onEscPress);\n      refs.backdrop.addEventListener('click', onBackdropClick);\n    });\n  } catch (error) {\n    Notiflix.Notify.failure(error.message);\n  }\n}\n\nfunction onWatchedCard() {\n  watchedRemove = document.querySelector('[data-watched-remove]');\n  watchedRemove.addEventListener('click', removeFromWatchedLib);\n}\n\nfunction onQueueCard() {\n  queueRemove = document.querySelector('[data-queue-remove]');\n  queueRemove.addEventListener('click', removeFromQueueLib);\n}\n\nasync function removeFromWatchedLib() {\n  const { userId, userEmail, watchedMovies, queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n  const filtered = watchedMovies.filter(movie => {\n    return movie.id !== currentMovie.id;\n  });\n  await setDoc(doc(db, 'users', auth.currentUser.uid), {\n    userId,\n    userEmail,\n    watchedMovies: filtered,\n    queuedMovies,\n  });\n  paginationSettings.maxPages = Math.ceil(filtered.length / 20);\n  let paginatedResults = filtered.filter((result, index) => {\n    return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n  });\n\n  console.log(paginatedResults);\n\n  if (paginatedResults.length === 0) {\n    console.log('empty');\n    movieApi.page -= 1;\n    paginatedResults = filtered.filter((result, index) => {\n      return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n    });\n  }\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  initializePagination();\n  toggleLibraryModal();\n  Notiflix.Notify.success('Removed successfully');\n}\n\nasync function removeFromQueueLib() {\n  const { userId, userEmail, watchedMovies, queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n  const filtered = queuedMovies.filter(movie => {\n    return movie.id !== currentMovie.id;\n  });\n  await setDoc(doc(db, 'users', auth.currentUser.uid), {\n    userId,\n    userEmail,\n    watchedMovies,\n    queuedMovies: filtered,\n  });\n  paginationSettings.maxPages = Math.ceil(filtered.length / 20);\n  let paginatedResults = filtered.filter((result, index) => {\n    return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n  });\n\n  console.log(paginatedResults);\n\n  if (paginatedResults.length === 0) {\n    console.log('empty');\n    movieApi.page -= 1;\n    paginatedResults = filtered.filter((result, index) => {\n      return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n    });\n  }\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  initializePagination();\n  toggleLibraryModal();\n  Notiflix.Notify.success('Removed successfully');\n}\n\nfunction toggleLibraryModal() {\n  refs.backdrop.classList.toggle('is-hidden');\n  refs.body.classList.toggle('locked');\n  window.removeEventListener('keydown', onEscPress);\n  refs.modalCloseBtn.removeEventListener('click', toggleLibraryModal);\n  refs.backdrop.removeEventListener('click', onBackdropClick);\n  if (watchedRemove) {\n    watchedRemove.removeEventListener('click', removeFromWatched);\n  } else {\n    queueRemove.removeEventListener('click', removeFromQueue);\n  }\n}\n\nfunction onEscPress(e) {\n  if ((e.code = 'ESC')) {\n    toggleLibraryModal();\n  }\n}\n\nfunction onBackdropClick(e) {\n  if (e.target === e.currentTarget) {\n    toggleLibraryModal();\n  }\n}\n"],"names":["parcelRequire","$krGWQ","$1cafa503bc57b7a0$var$watchedBtn","document","querySelector","$1cafa503bc57b7a0$var$queueBtn","async","$1cafa503bc57b7a0$var$onWatchedClick","$bMZn5","auth","currentUser","$parcel$interopDefault","$eWCmQ","Notify","failure","$ioBS9","spinner","show","$epB3k","movieApi","resetPage","refs","movieList","innerHTML","classList","add","remove","watchedMovies","$ftYLF","getDoc","doc","db","uid","then","res","data","$2nhTy","paginationSettings","paginationType","maxPages","Math","ceil","length","perPage","console","log","initializePagination","markup","filter","result","index","page","map","$9L75J","cardLibraryTemplate","join","close","$eyjy7","onAuthStateChanged","user","authSignOut","parentElement","authOpen","pagination","addEventListener","queuedMovies","$a7452d7014976e84$var$watchedRemove","$a7452d7014976e84$var$queueRemove","$a7452d7014976e84$var$currentMovie","$a7452d7014976e84$var$removeFromWatchedLib","userId","userEmail","filtered","movie","id","setDoc","paginatedResults","$a7452d7014976e84$var$toggleLibraryModal","success","$a7452d7014976e84$var$removeFromQueueLib","backdrop","toggle","body","window","removeEventListener","$a7452d7014976e84$var$onEscPress","modalCloseBtn","$a7452d7014976e84$var$onBackdropClick","removeFromWatched","removeFromQueue","e","code","target","currentTarget","card","closest","dataset","getMovie","formattedData","$kFh99","dataFormat","modalMarkup","selectedWatchedTemplate","movieModal","selectedQueueTemplate","error","message"],"version":3,"file":"library.97d05b05.js.map"}
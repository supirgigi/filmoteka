function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},n={},a=t.parcelRequired7c6;null==a&&((a=function(e){if(e in i)return i[e].exports;if(e in n){var t=n[e];delete n[e];var a={id:e,exports:{}};return i[e]=a,t.call(a.exports,a,a.exports),a.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){n[e]=t},t.parcelRequired7c6=a),a("epB3k"),a("krGWQ"),a("bMZn5");var s=a("krGWQ"),o=a("ftYLF"),r=a("2nhTy"),c=a("epB3k"),d=a("9L75J"),l=(r=a("2nhTy"),a("eWCmQ")),u=a("ioBS9"),g=a("eyjy7"),p=a("bMZn5");const m=document.querySelector("[data-watched]"),v=document.querySelector("[data-queue]");async function f(){if(!p.auth.currentUser)return void e(l).Notify.failure("Please sign in");u.spinner.show(),c.movieApi.resetPage(),s.refs.movieList.innerHTML="",m.classList.add("library-btns__btn_current"),v.classList.remove("library-btns__btn_current");const{watchedMovies:t}=await(0,o.getDoc)((0,o.doc)(p.db,"users",p.auth.currentUser.uid)).then((e=>e.data()));r.paginationSettings.paginationType="watched",r.paginationSettings.maxPages=Math.ceil(t.length/r.paginationSettings.perPage),console.log("watched movies: ",t),console.log(r.paginationSettings.maxPages),(0,r.initializePagination)();const i=t.filter(((e,t)=>t<c.movieApi.page*r.paginationSettings.perPage)).map(d.cardLibraryTemplate).join("");s.refs.movieList.innerHTML=i,u.spinner.close()}(0,g.onAuthStateChanged)(p.auth,(e=>{e?(console.log("user logged in: ",e),s.refs.authSignOut.parentElement.classList.remove("hidden"),s.refs.authOpen.parentElement.classList.add("hidden"),f()):(console.log("user logged out"),s.refs.authSignOut.parentElement.classList.add("hidden"),s.refs.authOpen.parentElement.classList.remove("hidden"),s.refs.pagination.classList.add("visually-hidden"))})),m.addEventListener("click",f),v.addEventListener("click",(async function(){if(!p.auth.currentUser)return void e(l).Notify.failure("Please sign in");u.spinner.show(),c.movieApi.resetPage(),s.refs.movieList.innerHTML="",m.classList.remove("library-btns__btn_current"),v.classList.add("library-btns__btn_current");const{queuedMovies:t}=await(0,o.getDoc)((0,o.doc)(p.db,"users",p.auth.currentUser.uid)).then((e=>e.data()));r.paginationSettings.paginationType="queue",r.paginationSettings.maxPages=Math.ceil(t.length/r.paginationSettings.perPage),console.log("queue movies: ",t),console.log(r.paginationSettings.maxPages),(0,r.initializePagination)();const i=t.filter(((e,t)=>t<c.movieApi.page*r.paginationSettings.perPage)).map(d.cardLibraryTemplate).join("");s.refs.movieList.innerHTML=i,u.spinner.close()})),a("2nhTy");s=a("krGWQ"),c=a("epB3k");var h=a("kFh99");p=a("bMZn5"),d=a("9L75J"),o=a("ftYLF"),r=a("2nhTy"),l=a("eWCmQ");let L,y,b;async function M(){const{userId:t,userEmail:i,watchedMovies:n,queuedMovies:a}=await(0,o.getDoc)((0,o.doc)(p.db,"users",p.auth.currentUser.uid)).then((e=>e.data())),u=n.filter((e=>e.id!==b.id));await(0,o.setDoc)((0,o.doc)(p.db,"users",p.auth.currentUser.uid),{userId:t,userEmail:i,watchedMovies:u,queuedMovies:a}),r.paginationSettings.maxPages=Math.ceil(u.length/20);let g=u.filter(((e,t)=>t<20*c.movieApi.page&&t>=20*c.movieApi.page-20));console.log(g),0===g.length&&(console.log("empty"),c.movieApi.page-=1,g=u.filter(((e,t)=>t<20*c.movieApi.page&&t>=20*c.movieApi.page-20)));const m=g.map(d.cardLibraryTemplate).join("");s.refs.movieList.innerHTML=m,(0,r.initializePagination)(),k(),e(l).Notify.success("Removed successfully")}async function w(){const{userId:t,userEmail:i,watchedMovies:n,queuedMovies:a}=await(0,o.getDoc)((0,o.doc)(p.db,"users",p.auth.currentUser.uid)).then((e=>e.data())),u=a.filter((e=>e.id!==b.id));await(0,o.setDoc)((0,o.doc)(p.db,"users",p.auth.currentUser.uid),{userId:t,userEmail:i,watchedMovies:n,queuedMovies:u}),r.paginationSettings.maxPages=Math.ceil(u.length/20);let g=u.filter(((e,t)=>t<20*c.movieApi.page&&t>=20*c.movieApi.page-20));console.log(g),0===g.length&&(console.log("empty"),c.movieApi.page-=1,g=u.filter(((e,t)=>t<20*c.movieApi.page&&t>=20*c.movieApi.page-20)));const m=g.map(d.cardLibraryTemplate).join("");s.refs.movieList.innerHTML=m,(0,r.initializePagination)(),k(),e(l).Notify.success("Removed successfully")}function k(){s.refs.backdrop.classList.toggle("is-hidden"),s.refs.body.classList.toggle("locked"),window.removeEventListener("keydown",T),s.refs.modalCloseBtn.removeEventListener("click",k),s.refs.backdrop.removeEventListener("click",E),L?L.removeEventListener("click",removeFromWatched):y.removeEventListener("click",removeFromQueue)}function T(e){e.code="ESC",k()}function E(e){e.target===e.currentTarget&&k()}s.refs.movieList.addEventListener("click",(function(t){if(t.target===t.currentTarget)return;const i=t.target.closest("li");c.movieApi.id=i.dataset.id;try{c.movieApi.getMovie().then((e=>{const t=(0,h.dataFormat)(e);let i;b=t,console.log(b),"watched"===r.paginationSettings.paginationType?(i=(0,d.selectedWatchedTemplate)(t),s.refs.movieModal.innerHTML=i,L=document.querySelector("[data-watched-remove]"),L.addEventListener("click",M)):(i=(0,d.selectedQueueTemplate)(t),s.refs.movieModal.innerHTML=i,y=document.querySelector("[data-queue-remove]"),y.addEventListener("click",w)),s.refs.backdrop.classList.toggle("is-hidden"),s.refs.body.classList.toggle("locked"),s.refs.modalCloseBtn.addEventListener("click",k),window.addEventListener("keydown",T),s.refs.backdrop.addEventListener("click",E)}))}catch(t){e(l).Notify.failure(t.message)}})),a("hMaZ9"),a("ioBS9");
//# sourceMappingURL=library.97d05b05.js.map

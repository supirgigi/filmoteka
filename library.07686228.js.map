{"mappings":"kpBAsBA,IAAAA,EACAC,E,iJArBA,IAAIC,EAAU,GAoBdF,EAlBA,SAAkBG,GAGhB,IAFA,IAAIC,EAAOC,OAAOD,KAAKD,GAEdG,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAC/BJ,EAAQE,EAAKE,IAAMH,EAAMC,EAAKE,G,EAelCL,EAXA,SAAiBO,GACf,IAAIC,EAAWP,EAAQM,GAEvB,GAAgB,MAAZC,EACF,MAAM,IAAIC,MAAM,oCAAsCF,GAGxD,OAAOC,C,KCnBTE,EAAA,SAAAC,SAA8CC,KAAKC,MAAM,kJCAzDH,EAAA,S,sBCAA,IAAAI,EAAAJ,EAAA,S,uHCAiB,IAAAK,IAAoBL,EAAA,SAAAM,QAA6C,SAAQC,OAAAC,KAAAC,KAAEC,WDY5F,MAAMC,EAAaC,SAASC,cAAc,kBACpCC,EAAWF,SAASC,cAAc,gBAwBxCE,eAAeC,IACb,IAAKC,EAAAC,KAAKC,YAER,YADAC,EAAAC,GAASC,OAAOC,QAAQ,kBAI1BC,EAAAC,QAAQC,OAERC,EAAAC,SAASC,YAETzB,EAAA0B,KAAKC,UAAUC,UAAY,GAC3BrB,EAAWsB,UAAUC,IAAI,6BACzBpB,EAASmB,UAAUE,OAAO,6BAE1B,MAAMC,cAAEA,SAAwB,EAAAC,EAAAC,SAC9B,EAAAD,EAAAE,KAAItB,EAAAuB,GAAI,QAASvB,EAAAC,KAAKC,YAAYsB,MAClCC,MAAKC,GACEA,EAAIC,SAGbC,EAAAC,mBAAmBC,eAAiB,UACpCF,EAAAC,mBAAmBE,SAAWC,KAAKC,KACjCd,EAAcxC,OAASiD,EAAAC,mBAAmBK,SAG5CC,QAAQC,IAAI,mBAAoBjB,GAChCgB,QAAQC,IAAIR,EAAAC,mBAAmBE,WAC/B,EAAAH,EAAAS,wBAEA,MAIMC,EAJmBnB,EAAcoB,QAAO,CAACC,EAAQC,IAC9CA,EAAQ/B,EAAAC,SAAS+B,KAAOd,EAAAC,mBAAmBK,UAGpBS,IAAIC,EAAAC,qBAAqBC,KAAK,IAC9D3D,EAAA0B,KAAKC,UAAUC,UAAYuB,EAC3B/B,EAAAC,QAAQuC,O,EAzDV,EAAAC,EAAAC,oBAAmBjD,EAAAC,MAAMiD,IACnBA,GAEFf,QAAQC,IAAI,mBAAoBc,GAChC/D,EAAA0B,KAAKsC,YAAYC,cAAcpC,UAAUE,OAAO,UAChD/B,EAAA0B,KAAKwC,SAASD,cAAcpC,UAAUC,IAAI,UAC1ClB,MAGAoC,QAAQC,IAAI,mBACZjD,EAAA0B,KAAKsC,YAAYC,cAAcpC,UAAUC,IAAI,UAC7C9B,EAAA0B,KAAKwC,SAASD,cAAcpC,UAAUE,OAAO,UAC7C/B,EAAA0B,KAAKyC,WAAWtC,UAAUC,IAAI,mB,IAOlCvB,EAAW6D,iBAAiB,QAASxD,GACrCF,EAAS0D,iBAAiB,SAwC1BzD,iBACE,IAAKE,EAAAC,KAAKC,YAER,YADAC,EAAAC,GAASC,OAAOC,QAAQ,kBAI1BC,EAAAC,QAAQC,OAERC,EAAAC,SAASC,YAETzB,EAAA0B,KAAKC,UAAUC,UAAY,GAC3BrB,EAAWsB,UAAUE,OAAO,6BAC5BrB,EAASmB,UAAUC,IAAI,6BAEvB,MAAMuC,aAAEA,SAAuB,EAAApC,EAAAC,SAC7B,EAAAD,EAAAE,KAAItB,EAAAuB,GAAI,QAASvB,EAAAC,KAAKC,YAAYsB,MAClCC,MAAKC,GACEA,EAAIC,SAGbC,EAAAC,mBAAmBC,eAAiB,QACpCF,EAAAC,mBAAmBE,SAAWC,KAAKC,KACjCuB,EAAa7E,OAASiD,EAAAC,mBAAmBK,SAG3CC,QAAQC,IAAI,iBAAkBoB,GAC9BrB,QAAQC,IAAIR,EAAAC,mBAAmBE,WAC/B,EAAAH,EAAAS,wBACA,MAIMC,EAJmBkB,EAAajB,QAAO,CAACC,EAAQC,IAC7CA,EAAQ/B,EAAAC,SAAS+B,KAAOd,EAAAC,mBAAmBK,UAGpBS,IAAIC,EAAAC,qBAAqBC,KAAK,IAC9D3D,EAAA0B,KAAKC,UAAUC,UAAYuB,EAE3B/B,EAAAC,QAAQuC,O,eE9GV5D,EAAAJ,EAAA,S,aAAA,I,8EAeA,IAAI0E,EACAC,EACAC,EA2CJ7D,eAAe8D,IACb,MAAMC,OAAEA,EAAMC,UAAEA,EAAS3C,cAAEA,EAAaqC,aAAEA,SAAuB,EAAApC,EAAAC,SAC/D,EAAAD,EAAAE,KAAItB,EAAAuB,GAAI,QAASvB,EAAAC,KAAKC,YAAYsB,MAClCC,MAAKC,GACEA,EAAIC,SAEPoC,EAAW5C,EAAcoB,QAAOyB,GAC7BA,EAAMpF,KAAO+E,EAAa/E,WAE7B,EAAAwC,EAAA6C,SAAO,EAAA7C,EAAAE,KAAItB,EAAAuB,GAAI,QAASvB,EAAAC,KAAKC,YAAYsB,KAAM,C,OACnDqC,E,UACAC,EACA3C,cAAe4C,E,aACfP,IAEF5B,EAAAC,mBAAmBE,SAAWC,KAAKC,KAAK8B,EAASpF,OAAS,IAC1D,IAAIuF,EAAmBH,EAASxB,QAAO,CAACC,EAAQC,IACvCA,EAAwB,GAAhB/B,EAAAC,SAAS+B,MAAaD,GAAyB,GAAhB/B,EAAAC,SAAS+B,KAAY,KAGrEP,QAAQC,IAAI8B,GAEoB,IAA5BA,EAAiBvF,SACnBwD,QAAQC,IAAI,SACZ1B,EAAAC,SAAS+B,MAAQ,EACjBwB,EAAmBH,EAASxB,QAAO,CAACC,EAAQC,IACnCA,EAAwB,GAAhB/B,EAAAC,SAAS+B,MAAaD,GAAyB,GAAhB/B,EAAAC,SAAS+B,KAAY,MAGvE,MAAMJ,EAAS4B,EAAiBvB,IAAIC,EAAAC,qBAAqBC,KAAK,IAC9D3D,EAAA0B,KAAKC,UAAUC,UAAYuB,GAC3B,EAAAV,EAAAS,wBACA8B,IACAhE,EAAAC,GAASC,OAAO+D,QAAQ,uB,CAG1BtE,eAAeuE,IACb,MAAMR,OAAEA,EAAMC,UAAEA,EAAS3C,cAAEA,EAAaqC,aAAEA,SAAuB,EAAApC,EAAAC,SAC/D,EAAAD,EAAAE,KAAItB,EAAAuB,GAAI,QAASvB,EAAAC,KAAKC,YAAYsB,MAClCC,MAAKC,GACEA,EAAIC,SAEPoC,EAAWP,EAAajB,QAAOyB,GAC5BA,EAAMpF,KAAO+E,EAAa/E,WAE7B,EAAAwC,EAAA6C,SAAO,EAAA7C,EAAAE,KAAItB,EAAAuB,GAAI,QAASvB,EAAAC,KAAKC,YAAYsB,KAAM,C,OACnDqC,E,UACAC,E,cACA3C,EACAqC,aAAcO,IAEhBnC,EAAAC,mBAAmBE,SAAWC,KAAKC,KAAK8B,EAASpF,OAAS,IAC1D,IAAIuF,EAAmBH,EAASxB,QAAO,CAACC,EAAQC,IACvCA,EAAwB,GAAhB/B,EAAAC,SAAS+B,MAAaD,GAAyB,GAAhB/B,EAAAC,SAAS+B,KAAY,KAGrEP,QAAQC,IAAI8B,GAEoB,IAA5BA,EAAiBvF,SACnBwD,QAAQC,IAAI,SACZ1B,EAAAC,SAAS+B,MAAQ,EACjBwB,EAAmBH,EAASxB,QAAO,CAACC,EAAQC,IACnCA,EAAwB,GAAhB/B,EAAAC,SAAS+B,MAAaD,GAAyB,GAAhB/B,EAAAC,SAAS+B,KAAY,MAGvE,MAAMJ,EAAS4B,EAAiBvB,IAAIC,EAAAC,qBAAqBC,KAAK,IAC9D3D,EAAA0B,KAAKC,UAAUC,UAAYuB,GAC3B,EAAAV,EAAAS,wBACA8B,IACAhE,EAAAC,GAASC,OAAO+D,QAAQ,uB,CAG1B,SAASD,IACPhF,EAAA0B,KAAKyD,SAAStD,UAAUuD,OAAO,aAC/BpF,EAAA0B,KAAK2D,KAAKxD,UAAUuD,OAAO,UAC3BE,OAAOC,oBAAoB,UAAWC,GACtCxF,EAAA0B,KAAK+D,cAAcF,oBAAoB,QAASP,GAChDhF,EAAA0B,KAAKyD,SAASI,oBAAoB,QAASG,GACvCpB,EACFA,EAAciB,oBAAoB,QAASd,GAE3CF,EAAYgB,oBAAoB,QAASL,E,CAI7C,SAASM,EAAWG,GACbA,EAAEC,KAAO,MACZZ,G,CAIJ,SAASU,EAAgBC,GACnBA,EAAEE,SAAWF,EAAEG,eACjBd,G,CA5IJhF,EAAA0B,KAAKC,UAAUyC,iBAAiB,SAMhC,SAAwBuB,GACtB,GAAIA,EAAEE,SAAWF,EAAEG,cACjB,OAEF,MAAMC,EAAOJ,EAAEE,OAAOG,QAAQ,MAC9BzE,EAAAC,SAAS/B,GAAKsG,EAAKE,QAAQxG,GAC3B8B,EAAAC,SAAS0E,WAAW5D,MAAKE,IACvB,MAAM2D,GAAgB,EAAAC,EAAAC,YAAW7D,GAEjC,IAAI8D,EADJ9B,EAAe2B,EAEfnD,QAAQC,IAAIuB,GAE8B,YAAtC/B,EAAAC,mBAAmBC,gBACrB2D,GAAc,EAAA7C,EAAA8C,yBAAwBJ,GACtCnG,EAAA0B,KAAK8E,WAAW5E,UAAY0E,EAkBhChC,EAAgB9D,SAASC,cAAc,yBACvC6D,EAAcF,iBAAiB,QAASK,KAhBpC6B,GAAc,EAAA7C,EAAAgD,uBAAsBN,GACpCnG,EAAA0B,KAAK8E,WAAW5E,UAAY0E,EAmBhC/B,EAAc/D,SAASC,cAAc,uBACrC8D,EAAYH,iBAAiB,QAASc,IAhBpClF,EAAA0B,KAAKyD,SAAStD,UAAUuD,OAAO,aAC/BpF,EAAA0B,KAAK2D,KAAKxD,UAAUuD,OAAO,UAE3BpF,EAAA0B,KAAK+D,cAAcrB,iBAAiB,QAASY,GAC7CM,OAAOlB,iBAAiB,UAAWoB,GACnCxF,EAAA0B,KAAKyD,SAASf,iBAAiB,QAASsB,EAAgB,G","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-d5168079d0099c4f.js","src/library.js","src/js/library.js","node_modules/@parcel/runtime-js/lib/runtime-e300f2c21b43ea0a.js","src/js/libraryModal.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"1zJhX\\\":\\\"library.07686228.js\\\",\\\"iqSmM\\\":\\\"sad-dog.fb588d9a.jpg\\\",\\\"b9auz\\\":\\\"index.23de0258.js\\\"}\"));","import './js/Api';\nimport './js/refs';\nimport './js/auth';\nimport './js/library';\nimport './js/pagination';\nimport './js/libraryModal';\nimport './js/authModal';\nimport './js/preloader';\n","import { refs } from './refs';\nimport { getDoc, doc } from 'firebase/firestore';\nimport { paginationSettings } from './pagination';\nimport { movieApi } from './Api';\nimport { cardLibraryTemplate } from './cardTemplate';\nimport { initializePagination } from './pagination';\nimport Notiflix from 'notiflix';\nimport { spinner } from './preloader';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { auth, db } from './auth';\nimport emptyColPic from '../images/sad-dog.jpg';\n\nconst watchedBtn = document.querySelector('[data-watched]');\nconst queueBtn = document.querySelector('[data-queue]');\n\nonAuthStateChanged(auth, user => {\n  if (user) {\n    // docRef = doc(db, 'users', `${user.uid}`);\n    console.log('user logged in: ', user);\n    refs.authSignOut.parentElement.classList.remove('hidden');\n    refs.authOpen.parentElement.classList.add('hidden');\n    onWatchedClick();\n    // console.log(docRef);\n  } else {\n    console.log('user logged out');\n    refs.authSignOut.parentElement.classList.add('hidden');\n    refs.authOpen.parentElement.classList.remove('hidden');\n    refs.pagination.classList.add('visually-hidden');\n    // refs.movieList.innerHTML = `<img src=${emptyColPic} style=\"margin: 0 auto;\"></img>`;\n    // docRef = null;\n    // console.log(docRef);\n  }\n});\n\nwatchedBtn.addEventListener('click', onWatchedClick);\nqueueBtn.addEventListener('click', onQueueClick);\n\nasync function onWatchedClick() {\n  if (!auth.currentUser) {\n    Notiflix.Notify.failure('Please sign in');\n    return;\n  }\n\n  spinner.show();\n\n  movieApi.resetPage();\n\n  refs.movieList.innerHTML = '';\n  watchedBtn.classList.add('library-btns__btn_current');\n  queueBtn.classList.remove('library-btns__btn_current');\n\n  const { watchedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n\n  paginationSettings.paginationType = 'watched';\n  paginationSettings.maxPages = Math.ceil(\n    watchedMovies.length / paginationSettings.perPage\n  );\n\n  console.log('watched movies: ', watchedMovies);\n  console.log(paginationSettings.maxPages);\n  initializePagination();\n\n  const paginatedResults = watchedMovies.filter((result, index) => {\n    return index < movieApi.page * paginationSettings.perPage;\n  });\n  // console.log('paginated results: ', paginatedResults);\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  spinner.close();\n}\n\nasync function onQueueClick() {\n  if (!auth.currentUser) {\n    Notiflix.Notify.failure('Please sign in');\n    return;\n  }\n\n  spinner.show();\n\n  movieApi.resetPage();\n\n  refs.movieList.innerHTML = '';\n  watchedBtn.classList.remove('library-btns__btn_current');\n  queueBtn.classList.add('library-btns__btn_current');\n\n  const { queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n\n  paginationSettings.paginationType = 'queue';\n  paginationSettings.maxPages = Math.ceil(\n    queuedMovies.length / paginationSettings.perPage\n  );\n\n  console.log('queue movies: ', queuedMovies);\n  console.log(paginationSettings.maxPages);\n  initializePagination();\n  const paginatedResults = queuedMovies.filter((result, index) => {\n    return index < movieApi.page * paginationSettings.perPage;\n  });\n  // console.log('paginated results: ', paginatedResults);\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n\n  spinner.close();\n}\n","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"iqSmM\")).toString();","import { refs } from './refs';\nimport { movieApi } from './Api';\nimport { dataFormat } from './dataFormat';\nimport { auth, db } from './auth';\nimport {\n  cardLibraryTemplate,\n  selectedQueueTemplate,\n  selectedWatchedTemplate,\n} from './cardTemplate';\nimport { getDoc, doc, setDoc } from 'firebase/firestore';\nimport { initializePagination, paginationSettings } from './pagination';\nimport Notiflix from 'notiflix';\n\nrefs.movieList.addEventListener('click', onLibraryClick);\n\nlet watchedRemove;\nlet queueRemove;\nlet currentMovie;\n\nfunction onLibraryClick(e) {\n  if (e.target === e.currentTarget) {\n    return;\n  }\n  const card = e.target.closest('li');\n  movieApi.id = card.dataset.id;\n  movieApi.getMovie().then(data => {\n    const formattedData = dataFormat(data);\n    currentMovie = formattedData;\n    let modalMarkup;\n    console.log(currentMovie);\n\n    if (paginationSettings.paginationType === 'watched') {\n      modalMarkup = selectedWatchedTemplate(formattedData);\n      refs.movieModal.innerHTML = modalMarkup;\n      onWatchedCard();\n    } else {\n      modalMarkup = selectedQueueTemplate(formattedData);\n      refs.movieModal.innerHTML = modalMarkup;\n      onQueueCard();\n    }\n\n    refs.backdrop.classList.toggle('is-hidden');\n    refs.body.classList.toggle('locked');\n\n    refs.modalCloseBtn.addEventListener('click', toggleLibraryModal);\n    window.addEventListener('keydown', onEscPress);\n    refs.backdrop.addEventListener('click', onBackdropClick);\n  });\n}\n\nfunction onWatchedCard() {\n  watchedRemove = document.querySelector('[data-watched-remove]');\n  watchedRemove.addEventListener('click', removeFromWatched);\n}\n\nfunction onQueueCard() {\n  queueRemove = document.querySelector('[data-queue-remove]');\n  queueRemove.addEventListener('click', removeFromQueue);\n}\n\nasync function removeFromWatched() {\n  const { userId, userEmail, watchedMovies, queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n  const filtered = watchedMovies.filter(movie => {\n    return movie.id !== currentMovie.id;\n  });\n  await setDoc(doc(db, 'users', auth.currentUser.uid), {\n    userId,\n    userEmail,\n    watchedMovies: filtered,\n    queuedMovies,\n  });\n  paginationSettings.maxPages = Math.ceil(filtered.length / 20);\n  let paginatedResults = filtered.filter((result, index) => {\n    return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n  });\n\n  console.log(paginatedResults);\n\n  if (paginatedResults.length === 0) {\n    console.log('empty');\n    movieApi.page -= 1;\n    paginatedResults = filtered.filter((result, index) => {\n      return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n    });\n  }\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  initializePagination();\n  toggleLibraryModal();\n  Notiflix.Notify.success('Removed successfully');\n}\n\nasync function removeFromQueue() {\n  const { userId, userEmail, watchedMovies, queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n  const filtered = queuedMovies.filter(movie => {\n    return movie.id !== currentMovie.id;\n  });\n  await setDoc(doc(db, 'users', auth.currentUser.uid), {\n    userId,\n    userEmail,\n    watchedMovies,\n    queuedMovies: filtered,\n  });\n  paginationSettings.maxPages = Math.ceil(filtered.length / 20);\n  let paginatedResults = filtered.filter((result, index) => {\n    return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n  });\n\n  console.log(paginatedResults);\n\n  if (paginatedResults.length === 0) {\n    console.log('empty');\n    movieApi.page -= 1;\n    paginatedResults = filtered.filter((result, index) => {\n      return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n    });\n  }\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  initializePagination();\n  toggleLibraryModal();\n  Notiflix.Notify.success('Removed successfully');\n}\n\nfunction toggleLibraryModal() {\n  refs.backdrop.classList.toggle('is-hidden');\n  refs.body.classList.toggle('locked');\n  window.removeEventListener('keydown', onEscPress);\n  refs.modalCloseBtn.removeEventListener('click', toggleLibraryModal);\n  refs.backdrop.removeEventListener('click', onBackdropClick);\n  if (watchedRemove) {\n    watchedRemove.removeEventListener('click', removeFromWatched);\n  } else {\n    queueRemove.removeEventListener('click', removeFromQueue);\n  }\n}\n\nfunction onEscPress(e) {\n  if ((e.code = 'ESC')) {\n    toggleLibraryModal();\n  }\n}\n\nfunction onBackdropClick(e) {\n  if (e.target === e.currentTarget) {\n    toggleLibraryModal();\n  }\n}\n"],"names":["$ef7689007096c8a0$export$6503ec6e8aabbaf","$ef7689007096c8a0$export$f7ad0328861e2f03","$ef7689007096c8a0$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$krGWQ","URL","resolve","import","meta","url","toString","$1cafa503bc57b7a0$var$watchedBtn","document","querySelector","$1cafa503bc57b7a0$var$queueBtn","async","$1cafa503bc57b7a0$var$onWatchedClick","$bMZn5","auth","currentUser","$parcel$interopDefault","$eWCmQ","Notify","failure","$ioBS9","spinner","show","$epB3k","movieApi","resetPage","refs","movieList","innerHTML","classList","add","remove","watchedMovies","$ftYLF","getDoc","doc","db","uid","then","res","data","$2nhTy","paginationSettings","paginationType","maxPages","Math","ceil","perPage","console","log","initializePagination","markup","filter","result","index","page","map","$9L75J","cardLibraryTemplate","join","close","$eyjy7","onAuthStateChanged","user","authSignOut","parentElement","authOpen","pagination","addEventListener","queuedMovies","$a7452d7014976e84$var$watchedRemove","$a7452d7014976e84$var$queueRemove","$a7452d7014976e84$var$currentMovie","$a7452d7014976e84$var$removeFromWatched","userId","userEmail","filtered","movie","setDoc","paginatedResults","$a7452d7014976e84$var$toggleLibraryModal","success","$a7452d7014976e84$var$removeFromQueue","backdrop","toggle","body","window","removeEventListener","$a7452d7014976e84$var$onEscPress","modalCloseBtn","$a7452d7014976e84$var$onBackdropClick","e","code","target","currentTarget","card","closest","dataset","getMovie","formattedData","$kFh99","dataFormat","modalMarkup","selectedWatchedTemplate","movieModal","selectedQueueTemplate"],"version":3,"file":"library.07686228.js.map"}
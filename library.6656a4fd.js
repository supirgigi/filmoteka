!function(){function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},i={},r=t.parcelRequired7c6;null==r&&((r=function(e){if(e in n)return n[e].exports;if(e in i){var t=i[e];delete i[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){i[e]=t},t.parcelRequired7c6=r),r("fkvfI"),r("4Nugj"),r("euqRf");var a=r("bpxeT"),s=r("2TvXO"),o=r("4Nugj"),c=r("6m2hf"),u=r("jcFG7"),d=r("fkvfI"),l=r("bXAnp"),p=(u=r("jcFG7"),r("iU1Pc")),g=r("4smAb"),f=r("gQOBw"),v=r("euqRf"),m=document.querySelector("[data-watched]"),h=document.querySelector("[data-queue]");function L(){return b.apply(this,arguments)}function b(){return(b=e(a)(e(s).mark((function t(){var n,i,r;return e(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(v.auth.currentUser){t.next=3;break}return e(p).Notify.failure("Please sign in"),t.abrupt("return");case 3:return g.spinner.show(),d.movieApi.resetPage(),o.refs.movieList.innerHTML="",m.classList.add("library-btns__btn_current"),h.classList.remove("library-btns__btn_current"),t.next=10,(0,c.getDoc)((0,c.doc)(v.db,"users",v.auth.currentUser.uid)).then((function(e){return e.data()}));case 10:n=t.sent.watchedMovies,u.paginationSettings.paginationType="watched",u.paginationSettings.maxPages=Math.ceil(n.length/u.paginationSettings.perPage),console.log("watched movies: ",n),console.log(u.paginationSettings.maxPages),(0,u.initializePagination)(),i=n.filter((function(e,t){return t<d.movieApi.page*u.paginationSettings.perPage})),r=i.map(l.cardLibraryTemplate).join(""),o.refs.movieList.innerHTML=r,g.spinner.close();case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(){return(y=e(a)(e(s).mark((function t(){var n,i,r;return e(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(v.auth.currentUser){t.next=3;break}return e(p).Notify.failure("Please sign in"),t.abrupt("return");case 3:return g.spinner.show(),d.movieApi.resetPage(),o.refs.movieList.innerHTML="",m.classList.remove("library-btns__btn_current"),h.classList.add("library-btns__btn_current"),t.next=10,(0,c.getDoc)((0,c.doc)(v.db,"users",v.auth.currentUser.uid)).then((function(e){return e.data()}));case 10:n=t.sent.queuedMovies,u.paginationSettings.paginationType="queue",u.paginationSettings.maxPages=Math.ceil(n.length/u.paginationSettings.perPage),console.log("queue movies: ",n),console.log(u.paginationSettings.maxPages),(0,u.initializePagination)(),i=n.filter((function(e,t){return t<d.movieApi.page*u.paginationSettings.perPage})),r=i.map(l.cardLibraryTemplate).join(""),o.refs.movieList.innerHTML=r,g.spinner.close();case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(0,f.onAuthStateChanged)(v.auth,(function(e){e?(console.log("user logged in: ",e),o.refs.authSignOut.parentElement.classList.remove("hidden"),o.refs.authOpen.parentElement.classList.add("hidden"),L()):(console.log("user logged out"),o.refs.authSignOut.parentElement.classList.add("hidden"),o.refs.authOpen.parentElement.classList.remove("hidden"),o.refs.pagination.classList.add("visually-hidden"))})),m.addEventListener("click",L),h.addEventListener("click",(function(){return y.apply(this,arguments)})),r("jcFG7");a=r("bpxeT"),s=r("2TvXO"),o=r("4Nugj"),d=r("fkvfI");var w,k,M,T=r("Db1qJ");v=r("euqRf"),l=r("bXAnp"),c=r("6m2hf"),u=r("jcFG7"),p=r("iU1Pc");function x(){return E.apply(this,arguments)}function E(){return(E=e(a)(e(s).mark((function t(){var n,i,r,a,g,f,m,h;return e(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.getDoc)((0,c.doc)(v.db,"users",v.auth.currentUser.uid)).then((function(e){return e.data()}));case 2:return n=t.sent,i=n.userId,r=n.userEmail,a=n.watchedMovies,g=n.queuedMovies,f=a.filter((function(e){return e.id!==M.id})),t.next=10,(0,c.setDoc)((0,c.doc)(v.db,"users",v.auth.currentUser.uid),{userId:i,userEmail:r,watchedMovies:f,queuedMovies:g});case 10:u.paginationSettings.maxPages=Math.ceil(f.length/20),m=f.filter((function(e,t){return t<20*d.movieApi.page&&t>=20*d.movieApi.page-20})),console.log(m),0===m.length&&(console.log("empty"),d.movieApi.page-=1,m=f.filter((function(e,t){return t<20*d.movieApi.page&&t>=20*d.movieApi.page-20}))),h=m.map(l.cardLibraryTemplate).join(""),o.refs.movieList.innerHTML=h,(0,u.initializePagination)(),P(),e(p).Notify.success("Removed successfully");case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function A(){return S.apply(this,arguments)}function S(){return(S=e(a)(e(s).mark((function t(){var n,i,r,a,g,f,m,h;return e(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.getDoc)((0,c.doc)(v.db,"users",v.auth.currentUser.uid)).then((function(e){return e.data()}));case 2:return n=t.sent,i=n.userId,r=n.userEmail,a=n.watchedMovies,g=n.queuedMovies,f=g.filter((function(e){return e.id!==M.id})),t.next=10,(0,c.setDoc)((0,c.doc)(v.db,"users",v.auth.currentUser.uid),{userId:i,userEmail:r,watchedMovies:a,queuedMovies:f});case 10:u.paginationSettings.maxPages=Math.ceil(f.length/20),m=f.filter((function(e,t){return t<20*d.movieApi.page&&t>=20*d.movieApi.page-20})),console.log(m),0===m.length&&(console.log("empty"),d.movieApi.page-=1,m=f.filter((function(e,t){return t<20*d.movieApi.page&&t>=20*d.movieApi.page-20}))),h=m.map(l.cardLibraryTemplate).join(""),o.refs.movieList.innerHTML=h,(0,u.initializePagination)(),P(),e(p).Notify.success("Removed successfully");case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function P(){o.refs.backdrop.classList.toggle("is-hidden"),o.refs.body.classList.toggle("locked"),window.removeEventListener("keydown",q),o.refs.modalCloseBtn.removeEventListener("click",P),o.refs.backdrop.removeEventListener("click",_),w?w.removeEventListener("click",removeFromWatched):k.removeEventListener("click",removeFromQueue)}function q(e){e.code="ESC",P()}function _(e){e.target===e.currentTarget&&P()}o.refs.movieList.addEventListener("click",(function(t){if(t.target===t.currentTarget)return;var n=t.target.closest("li");d.movieApi.id=n.dataset.id;try{d.movieApi.getMovie().then((function(e){var t,n=(0,T.dataFormat)(e);M=n,console.log(M),"watched"===u.paginationSettings.paginationType?(t=(0,l.selectedWatchedTemplate)(n),o.refs.movieModal.innerHTML=t,(w=document.querySelector("[data-watched-remove]")).addEventListener("click",x)):(t=(0,l.selectedQueueTemplate)(n),o.refs.movieModal.innerHTML=t,(k=document.querySelector("[data-queue-remove]")).addEventListener("click",A)),o.refs.backdrop.classList.toggle("is-hidden"),o.refs.body.classList.toggle("locked"),o.refs.modalCloseBtn.addEventListener("click",P),window.addEventListener("keydown",q),o.refs.backdrop.addEventListener("click",_)}))}catch(t){e(p).Notify.failure(t.message)}})),r("2yGCU"),r("4smAb")}();
//# sourceMappingURL=library.6656a4fd.js.map

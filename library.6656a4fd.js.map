{"mappings":"iiBAAAA,EAAA,S,sBCAA,IAAAC,EAAAD,EAAA,S,iJAWME,EAAaC,SAASC,cAAc,kBACpCC,EAAWF,SAASC,cAAc,gB,SAoBzBE,I,OAAAC,EAAcC,MAAAC,KAAAC,U,UAAdH,I,OAAAA,EAAfI,EAAAV,EAAA,CAAAU,EAAAC,GAAAC,MAAA,SAAAC,I,IAcUC,EAeFC,EAIAC,E,qEAhCDC,EAAAC,KAAKC,YAAW,C,sBACnBT,EAAAU,GAASC,OAAOC,QAAQ,kB,iCAI1BC,EAAAC,QAAQC,OAERC,EAAAC,SAASC,YAETC,EAAAC,KAAKC,UAAUC,UAAY,GAC3B/B,EAAWgC,UAAUC,IAAI,6BACzB9B,EAAS6B,UAAUE,OAAO,6B,WAEM,EAAAC,EAAAC,SAC9B,EAAAD,EAAAE,KAAIrB,EAAAsB,GAAI,QAAStB,EAAAC,KAAKC,YAAYqB,MAClCC,MAAK,SAAAC,GACL,OAAOA,EAAIC,M,YAHP7B,EAAe8B,EAAAC,KAAb/B,cAMRgC,EAAAC,mBAAmBC,eAAiB,UACpCF,EAAAC,mBAAmBE,SAAWC,KAAKC,KACjCrC,EAAcsC,OAASN,EAAAC,mBAAmBM,SAG5CC,QAAQC,IAAI,mBAAoBzC,GAChCwC,QAAQC,IAAIT,EAAAC,mBAAmBE,WAC/B,EAAAH,EAAAU,wBAEMzC,EAAmBD,EAAc2C,QAAO,SAACC,EAAQC,GACrD,OAAOA,EAAQjC,EAAAC,SAASiC,KAAOd,EAAAC,mBAAmBM,O,IAG9CrC,EAASD,EAAiB8C,IAAIC,EAAAC,qBAAqBC,KAAK,IAC9DnC,EAAAC,KAAKC,UAAUC,UAAYhB,EAC3BO,EAAAC,QAAQyC,Q,6CAnCmB1D,MAAAC,KAAAC,U,UAsCdyD,I,OAAAA,EAAfxD,EAAAV,EAAA,CAAAU,EAAAC,GAAAC,MAAA,SAAAC,I,IAcUsD,EAcFpD,EAIAC,E,qEA/BDC,EAAAC,KAAKC,YAAW,C,sBACnBT,EAAAU,GAASC,OAAOC,QAAQ,kB,iCAI1BC,EAAAC,QAAQC,OAERC,EAAAC,SAASC,YAETC,EAAAC,KAAKC,UAAUC,UAAY,GAC3B/B,EAAWgC,UAAUE,OAAO,6BAC5B/B,EAAS6B,UAAUC,IAAI,6B,WAEQ,EAAAE,EAAAC,SAC7B,EAAAD,EAAAE,KAAIrB,EAAAsB,GAAI,QAAStB,EAAAC,KAAKC,YAAYqB,MAClCC,MAAK,SAAAC,GACL,OAAOA,EAAIC,M,YAHPwB,EAAcvB,EAAAC,KAAZsB,aAMRrB,EAAAC,mBAAmBC,eAAiB,QACpCF,EAAAC,mBAAmBE,SAAWC,KAAKC,KACjCgB,EAAaf,OAASN,EAAAC,mBAAmBM,SAG3CC,QAAQC,IAAI,iBAAkBY,GAC9Bb,QAAQC,IAAIT,EAAAC,mBAAmBE,WAC/B,EAAAH,EAAAU,wBACMzC,EAAmBoD,EAAaV,QAAO,SAACC,EAAQC,GACpD,OAAOA,EAAQjC,EAAAC,SAASiC,KAAOd,EAAAC,mBAAmBM,O,IAG9CrC,EAASD,EAAiB8C,IAAIC,EAAAC,qBAAqBC,KAAK,IAC9DnC,EAAAC,KAAKC,UAAUC,UAAYhB,EAE3BO,EAAAC,QAAQyC,Q,6CAnCiB1D,MAAAC,KAAAC,U,EAxD3B,EAAA2D,EAAAC,oBAAmBpD,EAAAC,MAAM,SAAAoD,GACnBA,GAEFhB,QAAQC,IAAI,mBAAoBe,GAChCzC,EAAAC,KAAKyC,YAAYC,cAAcvC,UAAUE,OAAO,UAChDN,EAAAC,KAAK2C,SAASD,cAAcvC,UAAUC,IAAI,UAC1C7B,MAEAiD,QAAQC,IAAI,mBACZ1B,EAAAC,KAAKyC,YAAYC,cAAcvC,UAAUC,IAAI,UAC7CL,EAAAC,KAAK2C,SAASD,cAAcvC,UAAUE,OAAO,UAC7CN,EAAAC,KAAK4C,WAAWzC,UAAUC,IAAI,mB,IAIlCjC,EAAW0E,iBAAiB,QAAStE,GACrCD,EAASuE,iBAAiB,S,kBAwCXT,EAAY3D,MAAAC,KAAAC,U,eCtE3BT,EAAAD,EAAA,S,uCAAA,IAeI6E,EACAC,EACAC,E,uFA+CWC,I,OAAAC,EAAoBzE,MAAAC,KAAAC,U,UAApBuE,I,OAAAA,EAAftE,EAAAV,EAAA,CAAAU,EAAAC,GAAAC,MAAA,SAAAC,I,IAC6DoE,EAAnDC,EAAQC,EAAWrE,EAAeqD,EAKpCiB,EAUFrE,EAaEC,E,mFA5B2D,EAAAoB,EAAAC,SAC/D,EAAAD,EAAAE,KAAIrB,EAAAsB,GAAI,QAAStB,EAAAC,KAAKC,YAAYqB,MAClCC,MAAK,SAAAC,GACL,OAAOA,EAAIC,M,kBAH8CsC,EAIzDrC,EAAAC,KAJMqC,EAAmDD,EAAnDC,OAAQC,EAA2CF,EAA3CE,UAAWrE,EAAgCmE,EAAhCnE,cAAeqD,EAAiBc,EAAjBd,aAKpCiB,EAAWtE,EAAc2C,QAAO,SAAA4B,GACpC,OAAOA,EAAMC,KAAOR,EAAaQ,E,eAE7B,EAAAlD,EAAAmD,SAAO,EAAAnD,EAAAE,KAAIrB,EAAAsB,GAAI,QAAStB,EAAAC,KAAKC,YAAYqB,KAAM,CACnD0C,SACAC,YACArE,cAAesE,EACfjB,iB,QAEFrB,EAAAC,mBAAmBE,SAAWC,KAAKC,KAAKiC,EAAShC,OAAS,IACtDrC,EAAmBqE,EAAS3B,QAAO,SAACC,EAAQC,GAC9C,OAAOA,EAAwB,GAAhBjC,EAAAC,SAASiC,MAAaD,GAAyB,GAAhBjC,EAAAC,SAASiC,KAAY,E,IAGrEN,QAAQC,IAAIxC,GAEoB,IAA5BA,EAAiBqC,SACnBE,QAAQC,IAAI,SACZ7B,EAAAC,SAASiC,MAAQ,EACjB7C,EAAmBqE,EAAS3B,QAAO,SAACC,EAAQC,GAC1C,OAAOA,EAAwB,GAAhBjC,EAAAC,SAASiC,MAAaD,GAAyB,GAAhBjC,EAAAC,SAASiC,KAAY,E,KAGjE5C,EAASD,EAAiB8C,IAAIC,EAAAC,qBAAqBC,KAAK,IAC9DnC,EAAAC,KAAKC,UAAUC,UAAYhB,GAC3B,EAAA8B,EAAAU,wBACAgC,IACA9E,EAAAU,GAASC,OAAOoE,QAAQ,wB,6CAjCSlF,MAAAC,KAAAC,U,UAoCpBiF,I,OAAAC,EAAkBpF,MAAAC,KAAAC,U,UAAlBkF,I,OAAAA,EAAfjF,EAAAV,EAAA,CAAAU,EAAAC,GAAAC,MAAA,SAAAC,I,IAC6DoE,EAAnDC,EAAQC,EAAWrE,EAAeqD,EAKpCiB,EAUFrE,EAaEC,E,mFA5B2D,EAAAoB,EAAAC,SAC/D,EAAAD,EAAAE,KAAIrB,EAAAsB,GAAI,QAAStB,EAAAC,KAAKC,YAAYqB,MAClCC,MAAK,SAAAC,GACL,OAAOA,EAAIC,M,kBAH8CsC,EAIzDrC,EAAAC,KAJMqC,EAAmDD,EAAnDC,OAAQC,EAA2CF,EAA3CE,UAAWrE,EAAgCmE,EAAhCnE,cAAeqD,EAAiBc,EAAjBd,aAKpCiB,EAAWjB,EAAaV,QAAO,SAAA4B,GACnC,OAAOA,EAAMC,KAAOR,EAAaQ,E,eAE7B,EAAAlD,EAAAmD,SAAO,EAAAnD,EAAAE,KAAIrB,EAAAsB,GAAI,QAAStB,EAAAC,KAAKC,YAAYqB,KAAM,CACnD0C,SACAC,YACArE,gBACAqD,aAAciB,I,QAEhBtC,EAAAC,mBAAmBE,SAAWC,KAAKC,KAAKiC,EAAShC,OAAS,IACtDrC,EAAmBqE,EAAS3B,QAAO,SAACC,EAAQC,GAC9C,OAAOA,EAAwB,GAAhBjC,EAAAC,SAASiC,MAAaD,GAAyB,GAAhBjC,EAAAC,SAASiC,KAAY,E,IAGrEN,QAAQC,IAAIxC,GAEoB,IAA5BA,EAAiBqC,SACnBE,QAAQC,IAAI,SACZ7B,EAAAC,SAASiC,MAAQ,EACjB7C,EAAmBqE,EAAS3B,QAAO,SAACC,EAAQC,GAC1C,OAAOA,EAAwB,GAAhBjC,EAAAC,SAASiC,MAAaD,GAAyB,GAAhBjC,EAAAC,SAASiC,KAAY,E,KAGjE5C,EAASD,EAAiB8C,IAAIC,EAAAC,qBAAqBC,KAAK,IAC9DnC,EAAAC,KAAKC,UAAUC,UAAYhB,GAC3B,EAAA8B,EAAAU,wBACAgC,IACA9E,EAAAU,GAASC,OAAOoE,QAAQ,wB,6CAjCOlF,MAAAC,KAAAC,U,CAoCjC,SAAS+E,IACP3D,EAAAC,KAAK8D,SAAS3D,UAAU4D,OAAO,aAC/BhE,EAAAC,KAAKgE,KAAK7D,UAAU4D,OAAO,UAC3BE,OAAOC,oBAAoB,UAAWC,GACtCpE,EAAAC,KAAKoE,cAAcF,oBAAoB,QAASR,GAChD3D,EAAAC,KAAK8D,SAASI,oBAAoB,QAASG,GACvCvB,EACFA,EAAcoB,oBAAoB,QAASI,mBAE3CvB,EAAYmB,oBAAoB,QAASK,gB,CAI7C,SAASJ,EAAWK,GACbA,EAAEC,KAAO,MACZf,G,CAIJ,SAASW,EAAgBG,GACnBA,EAAEE,SAAWF,EAAEG,eACjBjB,G,CAhJJ3D,EAAAC,KAAKC,UAAU4C,iBAAiB,SAMhC,SAAwB2B,GACtB,GAAIA,EAAEE,SAAWF,EAAEG,cACjB,OAEF,IAAMC,EAAOJ,EAAEE,OAAOG,QAAQ,MAC9BjF,EAAAC,SAAS2D,GAAKoB,EAAKE,QAAQtB,GAC3B,IACE5D,EAAAC,SAASkF,WAAWpE,MAAK,SAAAE,GACvB,IAEImE,EAFEC,GAAgB,EAAAC,EAAAC,YAAWtE,GACjCmC,EAAeiC,EAEfzD,QAAQC,IAAIuB,GAE8B,YAAtChC,EAAAC,mBAAmBC,gBACrB8D,GAAc,EAAAhD,EAAAoD,yBAAwBH,GACtClF,EAAAC,KAAKqF,WAAWnF,UAAY8E,GAqBlClC,EAAgB1E,SAASC,cAAc,0BACzBwE,iBAAiB,QAASI,KAnBlC+B,GAAc,EAAAhD,EAAAsD,uBAAsBL,GACpClF,EAAAC,KAAKqF,WAAWnF,UAAY8E,GAsBlCjC,EAAc3E,SAASC,cAAc,wBACzBwE,iBAAiB,QAASe,IAnBlC7D,EAAAC,KAAK8D,SAAS3D,UAAU4D,OAAO,aAC/BhE,EAAAC,KAAKgE,KAAK7D,UAAU4D,OAAO,UAE3BhE,EAAAC,KAAKoE,cAAcvB,iBAAiB,QAASa,GAC7CO,OAAOpB,iBAAiB,UAAWsB,GACnCpE,EAAAC,KAAK8D,SAASjB,iBAAiB,QAASwB,E,IAE1C,MAAOkB,GACP3G,EAAAU,GAASC,OAAOC,QAAQ+F,EAAMC,Q","sources":["src/library.js","src/js/library.js","src/js/libraryModal.js"],"sourcesContent":["import './js/Api';\nimport './js/refs';\nimport './js/auth';\nimport './js/library';\nimport './js/pagination';\nimport './js/libraryModal';\nimport './js/authModal';\nimport './js/preloader';\n","import { refs } from './refs';\nimport { getDoc, doc } from 'firebase/firestore';\nimport { paginationSettings } from './pagination';\nimport { movieApi } from './Api';\nimport { cardLibraryTemplate } from './cardTemplate';\nimport { initializePagination } from './pagination';\nimport Notiflix from 'notiflix';\nimport { spinner } from './preloader';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { auth, db } from './auth';\n\nconst watchedBtn = document.querySelector('[data-watched]');\nconst queueBtn = document.querySelector('[data-queue]');\n\nonAuthStateChanged(auth, user => {\n  if (user) {\n    // docRef = doc(db, 'users', `${user.uid}`);\n    console.log('user logged in: ', user);\n    refs.authSignOut.parentElement.classList.remove('hidden');\n    refs.authOpen.parentElement.classList.add('hidden');\n    onWatchedClick();\n  } else {\n    console.log('user logged out');\n    refs.authSignOut.parentElement.classList.add('hidden');\n    refs.authOpen.parentElement.classList.remove('hidden');\n    refs.pagination.classList.add('visually-hidden');\n  }\n});\n\nwatchedBtn.addEventListener('click', onWatchedClick);\nqueueBtn.addEventListener('click', onQueueClick);\n\nasync function onWatchedClick() {\n  if (!auth.currentUser) {\n    Notiflix.Notify.failure('Please sign in');\n    return;\n  }\n\n  spinner.show();\n\n  movieApi.resetPage();\n\n  refs.movieList.innerHTML = '';\n  watchedBtn.classList.add('library-btns__btn_current');\n  queueBtn.classList.remove('library-btns__btn_current');\n\n  const { watchedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n\n  paginationSettings.paginationType = 'watched';\n  paginationSettings.maxPages = Math.ceil(\n    watchedMovies.length / paginationSettings.perPage\n  );\n\n  console.log('watched movies: ', watchedMovies);\n  console.log(paginationSettings.maxPages);\n  initializePagination();\n\n  const paginatedResults = watchedMovies.filter((result, index) => {\n    return index < movieApi.page * paginationSettings.perPage;\n  });\n  // console.log('paginated results: ', paginatedResults);\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  spinner.close();\n}\n\nasync function onQueueClick() {\n  if (!auth.currentUser) {\n    Notiflix.Notify.failure('Please sign in');\n    return;\n  }\n\n  spinner.show();\n\n  movieApi.resetPage();\n\n  refs.movieList.innerHTML = '';\n  watchedBtn.classList.remove('library-btns__btn_current');\n  queueBtn.classList.add('library-btns__btn_current');\n\n  const { queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n\n  paginationSettings.paginationType = 'queue';\n  paginationSettings.maxPages = Math.ceil(\n    queuedMovies.length / paginationSettings.perPage\n  );\n\n  console.log('queue movies: ', queuedMovies);\n  console.log(paginationSettings.maxPages);\n  initializePagination();\n  const paginatedResults = queuedMovies.filter((result, index) => {\n    return index < movieApi.page * paginationSettings.perPage;\n  });\n  // console.log('paginated results: ', paginatedResults);\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n\n  spinner.close();\n}\n","import { refs } from './refs';\nimport { movieApi } from './Api';\nimport { dataFormat } from './dataFormat';\nimport { auth, db } from './auth';\nimport {\n  cardLibraryTemplate,\n  selectedQueueTemplate,\n  selectedWatchedTemplate,\n} from './cardTemplate';\nimport { getDoc, doc, setDoc } from 'firebase/firestore';\nimport { initializePagination, paginationSettings } from './pagination';\nimport Notiflix from 'notiflix';\n\nrefs.movieList.addEventListener('click', onLibraryClick);\n\nlet watchedRemove;\nlet queueRemove;\nlet currentMovie;\n\nfunction onLibraryClick(e) {\n  if (e.target === e.currentTarget) {\n    return;\n  }\n  const card = e.target.closest('li');\n  movieApi.id = card.dataset.id;\n  try {\n    movieApi.getMovie().then(data => {\n      const formattedData = dataFormat(data);\n      currentMovie = formattedData;\n      let modalMarkup;\n      console.log(currentMovie);\n\n      if (paginationSettings.paginationType === 'watched') {\n        modalMarkup = selectedWatchedTemplate(formattedData);\n        refs.movieModal.innerHTML = modalMarkup;\n        onWatchedCard();\n      } else {\n        modalMarkup = selectedQueueTemplate(formattedData);\n        refs.movieModal.innerHTML = modalMarkup;\n        onQueueCard();\n      }\n\n      refs.backdrop.classList.toggle('is-hidden');\n      refs.body.classList.toggle('locked');\n\n      refs.modalCloseBtn.addEventListener('click', toggleLibraryModal);\n      window.addEventListener('keydown', onEscPress);\n      refs.backdrop.addEventListener('click', onBackdropClick);\n    });\n  } catch (error) {\n    Notiflix.Notify.failure(error.message);\n  }\n}\n\nfunction onWatchedCard() {\n  watchedRemove = document.querySelector('[data-watched-remove]');\n  watchedRemove.addEventListener('click', removeFromWatchedLib);\n}\n\nfunction onQueueCard() {\n  queueRemove = document.querySelector('[data-queue-remove]');\n  queueRemove.addEventListener('click', removeFromQueueLib);\n}\n\nasync function removeFromWatchedLib() {\n  const { userId, userEmail, watchedMovies, queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n  const filtered = watchedMovies.filter(movie => {\n    return movie.id !== currentMovie.id;\n  });\n  await setDoc(doc(db, 'users', auth.currentUser.uid), {\n    userId,\n    userEmail,\n    watchedMovies: filtered,\n    queuedMovies,\n  });\n  paginationSettings.maxPages = Math.ceil(filtered.length / 20);\n  let paginatedResults = filtered.filter((result, index) => {\n    return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n  });\n\n  console.log(paginatedResults);\n\n  if (paginatedResults.length === 0) {\n    console.log('empty');\n    movieApi.page -= 1;\n    paginatedResults = filtered.filter((result, index) => {\n      return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n    });\n  }\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  initializePagination();\n  toggleLibraryModal();\n  Notiflix.Notify.success('Removed successfully');\n}\n\nasync function removeFromQueueLib() {\n  const { userId, userEmail, watchedMovies, queuedMovies } = await getDoc(\n    doc(db, 'users', auth.currentUser.uid)\n  ).then(res => {\n    return res.data();\n  });\n  const filtered = queuedMovies.filter(movie => {\n    return movie.id !== currentMovie.id;\n  });\n  await setDoc(doc(db, 'users', auth.currentUser.uid), {\n    userId,\n    userEmail,\n    watchedMovies,\n    queuedMovies: filtered,\n  });\n  paginationSettings.maxPages = Math.ceil(filtered.length / 20);\n  let paginatedResults = filtered.filter((result, index) => {\n    return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n  });\n\n  console.log(paginatedResults);\n\n  if (paginatedResults.length === 0) {\n    console.log('empty');\n    movieApi.page -= 1;\n    paginatedResults = filtered.filter((result, index) => {\n      return index < movieApi.page * 20 && index >= movieApi.page * 20 - 20;\n    });\n  }\n  const markup = paginatedResults.map(cardLibraryTemplate).join('');\n  refs.movieList.innerHTML = markup;\n  initializePagination();\n  toggleLibraryModal();\n  Notiflix.Notify.success('Removed successfully');\n}\n\nfunction toggleLibraryModal() {\n  refs.backdrop.classList.toggle('is-hidden');\n  refs.body.classList.toggle('locked');\n  window.removeEventListener('keydown', onEscPress);\n  refs.modalCloseBtn.removeEventListener('click', toggleLibraryModal);\n  refs.backdrop.removeEventListener('click', onBackdropClick);\n  if (watchedRemove) {\n    watchedRemove.removeEventListener('click', removeFromWatched);\n  } else {\n    queueRemove.removeEventListener('click', removeFromQueue);\n  }\n}\n\nfunction onEscPress(e) {\n  if ((e.code = 'ESC')) {\n    toggleLibraryModal();\n  }\n}\n\nfunction onBackdropClick(e) {\n  if (e.target === e.currentTarget) {\n    toggleLibraryModal();\n  }\n}\n"],"names":["parcelRequire","$bpxeT","$93effc6fc56091ad$var$watchedBtn","document","querySelector","$93effc6fc56091ad$var$queueBtn","$93effc6fc56091ad$var$onWatchedClick","$93effc6fc56091ad$var$_onWatchedClick","apply","this","arguments","$parcel$interopDefault","$2TvXO","mark","_callee","watchedMovies","paginatedResults","markup","$euqRf","auth","currentUser","$iU1Pc","Notify","failure","$4smAb","spinner","show","$fkvfI","movieApi","resetPage","$4Nugj","refs","movieList","innerHTML","classList","add","remove","$6m2hf","getDoc","doc","db","uid","then","res","data","_ctx","sent","$jcFG7","paginationSettings","paginationType","maxPages","Math","ceil","length","perPage","console","log","initializePagination","filter","result","index","page","map","$bXAnp","cardLibraryTemplate","join","close","$93effc6fc56091ad$var$_onQueueClick","queuedMovies","$gQOBw","onAuthStateChanged","user","authSignOut","parentElement","authOpen","pagination","addEventListener","$c0832a3ae1aa9857$var$watchedRemove","$c0832a3ae1aa9857$var$queueRemove","$c0832a3ae1aa9857$var$currentMovie","$c0832a3ae1aa9857$var$removeFromWatchedLib","$c0832a3ae1aa9857$var$_removeFromWatchedLib","ref","userId","userEmail","filtered","movie","id","setDoc","$c0832a3ae1aa9857$var$toggleLibraryModal","success","$c0832a3ae1aa9857$var$removeFromQueueLib","$c0832a3ae1aa9857$var$_removeFromQueueLib","backdrop","toggle","body","window","removeEventListener","$c0832a3ae1aa9857$var$onEscPress","modalCloseBtn","$c0832a3ae1aa9857$var$onBackdropClick","removeFromWatched","removeFromQueue","e","code","target","currentTarget","card","closest","dataset","getMovie","modalMarkup","formattedData","$Db1qJ","dataFormat","selectedWatchedTemplate","movieModal","selectedQueueTemplate","error","message"],"version":3,"file":"library.6656a4fd.js.map"}